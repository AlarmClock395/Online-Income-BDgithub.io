<!doctype html>
<html lang="bn">
<link rel="shortcut icon" href="Online Income.png" type="image/o-icon">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Online Income BD</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    /* Modern Color Palette */
    :root{
      /* Primary Colors - Modern gradient theme */
      --primary: #6a11cb;
      --primary-dark: #4a00e0;
      --secondary: #2575fc;
      --accent: #ff6b6b;
      --success: #00d68f;
      --warning: #ffaa00;
      --danger: #ff3d71;
      --text-light: #ffffff;
      --text-dark: #2c3e50;
      --text-muted: #6c757d;
      --card-bg: #ffffff;
      --body-bg: #f5f7fa;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      --gradient-success: linear-gradient(135deg, #00d68f 0%, #00a854 100%);
      --gradient-warning: linear-gradient(135deg, #ffaa00 0%, #ff6b00 100%);
      --gradient-danger: linear-gradient(135deg, #ff3d71 0%, #c71e37 100%);
      --workup-green: #00b875;
      --workup-blue: #3293a3;
      --dark-bg: #1c212e;
      --bell-color: #00e676;
      --google-color: #4285f4;
    }
    
    * {
      box-sizing: border-box;
      font-family: 'Noto Sans Bengali', 'Poppins', sans-serif;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--body-bg);
      color: var(--text-dark);
    }
    
    /* Modern App Container */
    .app-container {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    
    /* Modern App Card */
    .app {
      width: 100%;
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      position: relative;
      z-index: 1;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .app::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: var(--gradient-primary);
    }
    
    /* Modern Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    header h1 {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary-dark);
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }
    
    .balance {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 26px;
      color: var(--primary-dark);
      font-weight: 700;
    }
    
    .notification-icon {
      position: relative;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .notification-icon:hover {
      background-color: rgba(106, 17, 203, 0.1);
    }
    
    .notification-icon i {
      font-size: 22px;
      color: var(--primary);
    }
    
    .notification-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
    }
    
    /* Profile Section */
    .profile-section {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      background: rgba(106, 17, 203, 0.05);
      border-radius: 15px;
      margin-bottom: 20px;
    }
    
    .profile-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: 700;
    }
    
    .profile-info {
      flex-grow: 1;
    }
    
    .profile-name {
      font-weight: 600;
      font-size: 18px;
      margin: 0;
      color: var(--text-dark);
    }
    
    .profile-email {
      font-size: 14px;
      color: var(--text-muted);
      margin: 0;
    }
    
    .profile-menu {
      position: relative;
    }
    
    .profile-menu-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--primary);
      font-size: 20px;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    
    .profile-menu-btn:hover {
      background-color: rgba(106, 17, 203, 0.1);
    }
    
    .profile-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      min-width: 180px;
      z-index: 10;
      display: none;
      overflow: hidden;
    }
    
    .profile-dropdown.active {
      display: block;
    }
    
    .profile-dropdown-item {
      padding: 12px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .profile-dropdown-item:hover {
      background-color: rgba(106, 17, 203, 0.05);
    }
    
    .profile-dropdown-item i {
      color: var(--primary);
      width: 20px;
    }
    
    .profile-dropdown-divider {
      height: 1px;
      background-color: #eee;
      margin: 5px 0;
    }
    
    /* Modern Description Box */
    .desc {
      color: var(--text-dark);
      background: rgba(106, 17, 203, 0.05);
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      font-weight: 600;
      text-align: center;
      border-left: 4px solid var(--primary);
    }
    
    /* Modern Controls */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    
    /* Modern Button */
    .btn {
      background: var(--gradient-primary);
      border: 0;
      color: var(--text-light);
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(106, 17, 203, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.5s ease;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(106, 17, 203, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 5px rgba(106, 17, 203, 0.2);
    }
    
    .btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .btn-success {
      background: var(--gradient-success);
      box-shadow: 0 4px 10px rgba(0, 214, 143, 0.2);
    }
    
    .btn-success:hover {
      box-shadow: 0 6px 15px rgba(0, 214, 143, 0.3);
    }
    
    .btn-danger {
      background: var(--gradient-danger);
      box-shadow: 0 4px 10px rgba(255, 61, 113, 0.2);
    }
    
    .btn-danger:hover {
      box-shadow: 0 6px 15px rgba(255, 61, 113, 0.3);
    }
    
    /* Google Button Style */
    .btn-google {
      background: white;
      color: var(--text-dark);
      border: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .btn-google:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      background: #f8f9fa;
    }
    
    .btn-google i {
      color: var(--google-color);
    }
    
    /* Modern Progress Ring */
    .big-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #f0f0f0;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .progress-half {
      position: absolute;
      width: 50%;
      height: 100%;
      overflow: hidden;
    }
    
    .left-half {
      left: 0;
    }
    
    .right-half {
      right: 0;
    }
    
    .progress-fill {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: var(--gradient-success);
      transition: transform 0.5s linear;
    }
    
    .right-half .progress-fill {
      left: -100%;
      transform-origin: 100% 50%;
    }
    
    .left-half .progress-fill {
      left: 0;
      transform-origin: 100% 50%;
      transform: rotate(-180deg);
    }
    
    .big-circle-inner {
      text-align: center;
      background: var(--card-bg);
      width: 130px;
      height: 130px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      padding: 5px 0;
    }
    
    .big-circle .label {
      font-weight: 600;
      color: var(--text-muted);
      font-size: 14px;
    }
    
    #todayCount {
      font-size: 42px;
      font-weight: 800;
      color: var(--primary-dark);
    }
    
    /* Modern Success Toast */
    .cream-strip {
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      top: 20px;
      height: 50px;
      background: var(--gradient-success);
      width: 300px;
      max-width: 90%;
      border-radius: 12px;
      transition: transform 0.5s cubic-bezier(0.2, 0.9, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--text-light);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      gap: 8px;
      font-size: 16px;
    }
    
    .cream-strip.show {
      transform: translateX(-50%) translateY(0);
    }
    
    /* Modern Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 15px;
      z-index: 100;
    }
    
    .modal.active {
      display: flex;
    }
    
    .ad-box {
      width: 100%;
      max-width: 380px;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .ad-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: var(--gradient-primary);
    }
    
    h3 {
      color: var(--primary-dark);
      margin-top: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 22px;
    }
    
    h3 i {
      font-size: 24px;
    }
    
    .ad-count {
      font-size: 40px;
      font-weight: 800;
      color: var(--secondary);
    }
    
    .ad-progress {
      height: 10px;
      background: #eee;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 15px;
    }
    
    .ad-progress > i {
      display: block;
      height: 100%;
      width: 0%;
      background: var(--gradient-success);
      transition: width 1s linear;
    }
    
    /* Modern Auth Panel */
    .auth-panel {
      width: 100%;
      max-width: 380px;
      background: var(--card-bg);
      padding: 0;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      overflow: hidden;
    }
    
    .auth-header {
      background: var(--gradient-primary);
      color: var(--text-light);
      padding: 20px;
      font-size: 20px;
      font-weight: 700;
      text-align: left;
    }
    
    .auth-content {
      padding: 25px;
    }
    
    .auth-panel h2 {
      display: none;
    }
    
    .input-group {
      position: relative;
      margin: 15px 0;
    }
    
    .input-group i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 18px;
      z-index: 5;
    }
    
    .input {
      width: 100%;
      padding: 15px 15px 15px 45px;
      margin: 0;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f9f9f9;
    }
    
    .input:focus {
      border-color: var(--primary);
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
    }
    
    .input:focus + i {
      color: var(--primary);
    }
    
    .term-checkbox-container {
      text-align: left;
      margin-top: 20px;
      margin-bottom: 20px;
      line-height: 1.4;
    }
    
    .term-checkbox-container label {
      font-size: 14px;
      color: var(--text-muted);
    }
    
    .term-checkbox-container a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }
    
    .muted {
      color: var(--danger);
      font-size: 14px;
      margin-top: 15px;
      font-weight: 600;
    }
    
    .muted a {
      color: var(--primary);
    }
    
    .login-footer-text {
      text-align: center;
      margin-top: 20px;
      font-size: 15px;
      font-weight: 500;
    }
    
    .login-footer-text a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .login-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .login-controls .btn {
      width: auto;
      padding: 12px 25px;
    }
    
    .login-controls .term-checkbox-container {
      margin: 0;
    }
    
    .login-link-group {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 15px;
      font-size: 14px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }
    
    .login-link-group a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .login-link-group .muted {
      margin: 0;
      text-align: left;
      color: var(--text-muted);
      font-weight: 500;
    }
    
    .login-link-group .muted a {
      color: var(--primary);
    }
    
    /* Social Login Divider */
    .social-divider {
      display: flex;
      align-items: center;
      margin: 20px 0;
    }
    
    .social-divider::before,
    .social-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background-color: #eee;
    }
    
    .social-divider span {
      padding: 0 10px;
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* Withdraw Modal Specific */
    #withdrawMethod, #withdrawName, #withdrawContact {
      font-size: 15px;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      width: 100%;
      margin: 10px 0;
      background: #f9f9f9;
      transition: all 0.3s ease;
    }
    
    #withdrawMethod:focus, #withdrawName:focus, #withdrawContact:focus {
      border-color: var(--primary);
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
    }
    
    #withdrawMsg {
      color: var(--danger);
      font-weight: 600;
    }
    
    .withdraw-controls {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }
    
    .withdraw-controls .btn {
      padding: 10px 15px;
      font-size: 14px;
      width: auto;
    }
    
    #closeWithdraw {
      background: #e0e0e0;
      color: var(--text-dark);
    }
    
    #closeWithdraw:hover {
      background: #d0d0d0;
    }
    
    /* Forgot Panel Special Style */
    #forgotPanel .auth-content .btn {
      margin-top: 15px;
    }
    
    /* Notification Panel */
    .notification-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      max-width: 100%;
      height: 100%;
      background: var(--dark-bg);
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
      z-index: 50;
      display: flex;
      flex-direction: column;
    }
    
    .notification-panel.open {
      transform: translateX(0);
    }
    
    .notification-header {
      color: var(--text-light);
      padding: 20px;
      font-size: 18px;
      font-weight: 700;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .notification-list-container {
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px 0;
    }
    
    .notification-item {
      display: flex;
      padding: 5px 20px 15px 20px;
      position: relative;
      color: var(--text-light);
      border-left: 2px dotted rgba(255, 255, 255, 0.2);
      margin-left: 30px;
      transition: background-color 0.2s;
      cursor: pointer;
    }
    
    .notification-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .notification-item:last-child {
      border-left: none;
      padding-bottom: 5px;
    }
    
    .notification-item.unread {
      background-color: rgba(0, 230, 118, 0.1);
      font-weight: 600;
    }
    
    .notification-bell {
      position: absolute;
      left: -18px;
      top: 0px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--bell-color);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
    }
    
    .notification-bell i {
      color: var(--dark-bg);
      font-size: 16px;
    }
    
    .notification-content {
      flex-grow: 1;
      padding-left: 10px;
    }
    
    .notification-time {
      display: block;
      font-size: 11px;
      color: #aaa;
      margin-top: 4px;
    }
    
    .notification-message {
      font-size: 14px;
      font-weight: 400;
      line-height: 1.4;
    }
    
    .notification-footer {
      padding: 10px 20px 15px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #aaa;
      font-size: 12px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .read-all-btn {
      background: var(--primary);
      color: var(--text-light);
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      margin-left: 10px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .empty-notification {
      text-align: center;
      color: #aaa;
      padding: 40px 20px;
      font-size: 15px;
    }
    
    /* Referral Section */
    .referral-section {
      margin-top: 20px;
      text-align: center;
      padding: 15px;
      border-radius: 15px;
      background: rgba(106, 17, 203, 0.05);
      border: 1px dashed rgba(106, 17, 203, 0.3);
    }
    
    .referral-section h3 {
      color: var(--primary-dark);
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .referral-section p {
      font-weight: 600;
      color: var(--text-dark);
      font-size: 15px;
      margin-bottom: 15px;
    }
    
    #userReferralCode {
      color: var(--primary);
      font-size: 18px;
      font-weight: 700;
      margin-right: 10px;
    }
    
    #shareReferralBtn {
      background: var(--gradient-primary);
      font-size: 15px;
      width: auto;
      padding: 10px 20px;
    }
    
    /* Ad Banner Container */
    .ad-banner-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      min-height: 50px;
      margin: 15px auto;
      text-align: center;
    }
    
    /* IP Warning Message */
    .ip-warning {
      background-color: rgba(255, 61, 113, 0.1);
      border-left: 4px solid var(--danger);
      color: var(--danger);
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .ip-warning.show {
      display: block;
    }
    
    /* Referral Warning Message */
    .referral-warning {
      background-color: rgba(255, 170, 0, 0.1);
      border-left: 4px solid var(--warning);
      color: var(--warning);
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .referral-warning.show {
      display: block;
    }
    
    /* Referral Stats */
    .referral-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 14px;
    }
    
    .referral-count {
      font-weight: 700;
      color: var(--primary);
    }
    
    /* Task Info Section */
    .task-info {
      background: rgba(37, 117, 252, 0.1);
      border-left: 4px solid var(--secondary);
      padding: 12px 15px;
      margin: 15px 0;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
      text-align: center;
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .app {
        padding: 20px;
      }
      
      header h1 {
        font-size: 20px;
      }
      
      .balance {
        font-size: 22px;
      }
      
      .big-circle {
        width: 130px;
        height: 130px;
      }
      
      .big-circle-inner {
        width: 110px;
        height: 110px;
      }
      
      #todayCount {
        font-size: 36px;
      }
      
      .notification-panel {
        width: 100%;
      }
    }
    
    @media (max-width: 350px) {
      .app {
        padding: 15px;
      }
      
      header {
        flex-direction: column;
        gap: 10px;
      }
      
      .header-content {
        width: 100%;
        justify-content: space-between;
      }
      
      .profile-section {
        flex-direction: column;
        text-align: center;
      }
      
      .login-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      
      .login-controls .btn {
        width: 100%;
      }
      
      .login-controls .term-checkbox-container {
        text-align: center;
      }
      
      .login-link-group {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="ad-banner-container">
      <script type="text/javascript"> atOptions = { 	'key' : 'a31f6440a4a178b774c075b06db0cbc5', 	'format' : 'iframe', 	'height' : 50, 	'width' : 320, 	'params' : {} }; </script> 
      <script type="text/javascript" src="https://www.highperformanceformat.com/a31f6440a4a178b774c075b06db0cbc5/invoke.js" ></script>
    </div>
    
    <div id="authContainer" style="display:flex;gap:12px;flex-direction:column;align-items:center;padding:12px 0">
      <div class="auth-panel" id="registerPanel">
        <div class="auth-header">Sign up with Your Real credentials</div>
        <div class="auth-content">
          <div class="input-group">
              <input id="regName" class="input" placeholder="Real name (for internal verific. only)" type="text">
              <i class="fa-solid fa-user"></i>
          </div>
          <div class="input-group">
              <input id="regEmail" class="input" placeholder="Email Address" type="email">
              <i class="fa-solid fa-envelope"></i>
          </div>
          
          <div class="input-group"> 
              <input id="regReferralCode" class="input" placeholder="Referral Code (Optional)" type="text" maxlength="6">
              <i class="fa-solid fa-code"></i>
          </div> 

          <div class="input-group">
              <input id="regPass" class="input" placeholder="Password" type="password">
              <i class="fa-solid fa-lock"></i>
          </div>
          
          <div class="term-checkbox-container" style="margin-top: 25px;">
              <input type="checkbox" id="termsCheck" style="width:auto; margin:0" />
              <label for="termsCheck">I agree to workupjobs <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>..</label>
          </div>

          <button class="btn" id="btnRegister">
              <i class="fa-solid fa-user-plus"></i> Create Account
          </button>
          
          <div class="social-divider">
            <span>OR</span>
          </div>
          
          <button class="btn btn-google" id="btnGoogleRegister">
              <i class="fab fa-google"></i> Sign up with Google
          </button>
          
          <div id="regMsg" class="muted"></div>
          <div id="ipWarning" class="ip-warning">
              <i class="fa-solid fa-exclamation-triangle"></i> এই IP ঠিকানা থেকে ইতিমধ্যে একটি অ্যাকাউন্ট রয়েছে। প্রতিটি IP ঠিকানা থেকে শুধুমাত্র একটি অ্যাকাউন্ট তৈরি করা যাবে।
          </div>
          <div id="referralWarning" class="referral-warning">
              <i class="fa-solid fa-exclamation-triangle"></i> এই রেফার কোডটি আর ব্যবহার করা যাবে না। একজন ব্যবহারকারী সর্বোচ্চ ১০ জনকে রেফার করতে পারেন।
          </div>
          <div class="login-footer-text">Already have an account? <a href="#" id="showLogin">Log in</a></div>
        </div>
      </div>

      <div class="auth-panel" id="loginPanel" style="display:none">
        <div class="auth-header">Sign in with your account</div>
        <div class="auth-content">
          <div class="input-group">
              <input id="loginEmail" class="input" placeholder="Email Address" type="email">
              <i class="fa-solid fa-envelope"></i>
          </div>
          <div class="input-group">
              <input id="loginPass" class="input" placeholder="Password" type="password">
              <i class="fa-solid fa-lock"></i>
          </div>
          
          <div class="login-controls">
              <div class="term-checkbox-container" style="margin: 0;">
                  <input type="checkbox" id="rememberMeCheck" style="width:auto; margin:0" checked />
                  <label for="rememberMeCheck" style="font-weight: 600;">Remember me</label>
              </div>
              <button class="btn" id="btnLogin">
                  <i class="fa-solid fa-right-to-bracket"></i> Login
              </button>
          </div>

          <div class="social-divider">
            <span>OR</span>
          </div>
          
          <button class="btn btn-google" id="btnGoogleLogin">
              <i class="fab fa-google"></i> Sign in with Google
          </button>
          
          <div id="loginMsg" class="muted"></div>
          
          <div class="login-link-group">
              <div class="muted">New to Work Up Job? <a href="#" id="showRegister">Create new account</a></div>
              <a href="#" id="forgotPasswordLink">Forgot password?</a>
          </div>
        </div>
      </div>

      <div class="auth-panel" id="forgotPanel" style="display:none">
        <div class="auth-header">Password Recovery</div>
        <div class="auth-content">
          <div class="input-group">
              <input id="resetEmail" class="input" placeholder="Email Address" type="email">
              <i class="fa-solid fa-envelope"></i>
          </div>
          
          <div style="margin-bottom: 25px;"></div> 
          
          <button class="btn" id="btnReset">
              <i class="fa-solid fa-paper-plane"></i> Reset
          </button>
          <div id="resetMsg" class="muted"></div>
          <div class="login-footer-text"><a href="#" id="showLoginFromForgot">Back to Login</a></div>
        </div>
      </div>
    </div>
    
    <div class="ad-banner-container" id="adBannerTop" style="display:none;">
      <script
        async="async"
        data-cfasync="false"
        src="https://pl28226820.effectivegatecpm.com/e5f22e841f39f37c4e5108d1c92a95c9/invoke.js"
      ></script>
      <div id="container-e5f22e841f39f37c4e5108d1c92a95c9" style="max-width: 300px; margin: 0 auto; height: 50px;"></div>
    </div>
    
    <div class="app" id="app" style="display:none">
      <header>
          <div class="header-content">
              <h1><i class="fa-solid fa-hand-holding-dollar"></i> আপনার ব্যালেন্স</h1>
          </div>
          
          <div class="header-content" style="gap:20px;">
              <div class="notification-icon" id="notificationIcon">
                  <i class="fa-solid fa-bell"></i>
                  <span class="notification-badge" id="notificationBadge" style="display:none">0</span>
              </div>
              <div class="balance" id="balanceNum">0.0</div> 
          </div>
      </header>

      <div class="profile-section">
          <div class="profile-avatar" id="profileAvatar">U</div>
          <div class="profile-info">
              <p class="profile-name" id="profileName">User Name</p>
              <p class="profile-email" id="profileEmail">user@example.com</p>
          </div>
          <div class="profile-menu">
              <button class="profile-menu-btn" id="profileMenuBtn">
                  <i class="fa-solid fa-ellipsis-v"></i>
              </button>
              <div class="profile-dropdown" id="profileDropdown">
                  <div class="profile-dropdown-item" id="viewProfileBtn">
                      <i class="fa-solid fa-user"></i> প্রোফাইল দেখুন
                  </div>
                  <div class="profile-dropdown-item" id="settingsBtn">
                      <i class="fa-solid fa-cog"></i> সেটিংস
                  </div>
                  <div class="profile-dropdown-divider"></div>
                  <div class="profile-dropdown-item" id="btnLogout">
                      <i class="fa-solid fa-sign-out-alt"></i> লগআউট
                  </div>
              </div>
          </div>
      </div>

      <div class="desc" id="welcomeMessage"></div> 

      <div class="big-circle" id="todayTask">
        <div class="progress-half left-half">
          <div class="progress-fill" id="leftFill"></div>
        </div>
        <div class="progress-half right-half">
          <div class="progress-fill" id="rightFill"></div>
        </div>
        <div class="big-circle-inner">
          <div class="label" id="taskLabel">আজকের কাজ</div>
          <div id="todayCount">0</div>
        </div>
      </div>

      <div class="task-info">
        <i class="fa-solid fa-info-circle"></i> প্রতিদিন সর্বনিম্ন ১০০ টা কাজ করতে হবে। প্রতিবার কাজ শেষে ০.১ পয়েন্ট যোগ হবে। সর্বোচ্চ ১০০ টা কাজ করতে পারবেন।
      </div>
      
      <div class="referral-section">
          <h3>
              <i class="fa-solid fa-people-group"></i> Share & Earn
          </h3>
          <p>
              আপনার রেফার কোড: 
              <span id="userReferralCode">Loading...</span>
              <textarea id="tempReferralCode" style="position: absolute; left: -9999px; height: 1px; width: 1px;"></textarea>
          </p>
          <div class="referral-stats">
              <span>আপনি রেফার করেছেন: <span id="referralCount" class="referral-count">0</span>/10 জন</span>
          </div>
          <button class="btn" id="shareReferralBtn">
              <i class="fa-solid fa-copy"></i> রেফার কোড কপি করুন 
          </button>
      </div> 
      
      <div class="ad-banner-container">
        <script
          async="async"
          data-cfasync="false"
          src="https://pl28226820.effectivegatecpm.com/5b23cb5726a82760ffa0b79a03ce5698/invoke.js"
        ></script>
        <div id="container-5b23cb5726a82760ffa0b79a03ce5698" style="max-width: 300px; margin: 0 auto; min-height: 250px;"></div>
      </div>
      
      <div class="controls">
        <button class="btn" id="watchAdBtn">
          <i class="fa-solid fa-eye"></i> কাজ করে আয় করুন
        </button>
        <button class="btn btn-success" id="withdrawBtn">
          <i class="fa-solid fa-wallet"></i> এখানে টাকা উত্তোলন করুন
        </button>
      </div>
    </div>
    
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <span>Latest notifications</span>
            <div>
              <button class="read-all-btn" id="readAllBtn" style="display:none"><i class="fa-solid fa-check-double"></i> Read all</button>
              <i class="fa-solid fa-xmark" id="closeNotification" style="font-size: 20px; cursor: pointer;"></i>
            </div>
        </div>
        <div class="notification-list-container" id="notificationList">
            <div class="empty-notification" id="emptyNotification">
                আপনার কোন নতুন নোটিফিকেশন নেই।
            </div>
        </div>
        <div class="notification-footer">
            Note: 60 Day older Notifications will get deleted
        </div>
    </div>
    
    <div class="cream-strip" id="creamStrip">
      <i class="fa-solid fa-circle-check"></i> আপনার ০.১ পয়েন্ট সফল!
    </div>
    
    <div class="modal" id="withdrawModal">
      <div class="ad-box">
        <h3><i class="fa-solid fa-sack-dollar"></i> টাকা উত্তোলন</h3>
        <p style="color:#666;font-weight:600; font-size:14px">মিনিমাম উত্তোলন: ২০ পয়েন্ট</p>
        
        <select id="withdrawMethod">
          <option value="">-- উত্তোলনের পদ্ধতি নির্বাচন করুন --</option>
          <option value="bkash">বিকাশ (bKash)</option>
          <option value="nagad">নগদ (Nagad)</option>
          <option value="recharge">মোবাইল রিচার্জ (Mobile Recharge)</option>
        </select>

        <input id="withdrawName" placeholder="আপনার নাম দিন" /> 

        <input id="withdrawContact" placeholder="আপনার নম্বর দিন" /> 
        
        <div class="withdraw-controls">
          <button class="btn" id="submitWithdraw">
              <i class="fa-solid fa-paper-plane"></i> রিকোয়েস্ট পাঠান
          </button>
          <button class="btn" id="closeWithdraw">
              <i class="fa-solid fa-ban"></i> বাতিল
          </button>
        </div>
        <div id="withdrawMsg"></div>
      </div>
    </div>
  </div>

  <script>
  /**************
   * IMPORTANT *
   * Replace the firebaseConfig object below with your project's config from Firebase Console.
   **************/
  const firebaseConfig = {
        apiKey: "AIzaSyARwuMKNRPwqvaq2HnM-cW52ZVoTrDOLIQ",
  authDomain: "walletsystem-808df.firebaseapp.com",
  databaseURL: "https://walletsystem-808df-default-rtdb.firebaseio.com",
  projectId: "walletsystem-808df",
  storageBucket: "walletsystem-808df.firebasestorage.app",
  messagingSenderId: "674874233210",
  appId: "1:674874233210:web:8588b19e748883182246c3",
  measurementId: "G-H7P92Y37HL"
};
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // Set up Google Auth Provider
  const googleProvider = new firebase.auth.GoogleAuthProvider();

  // UI Elements
  const registerPanel = document.getElementById('registerPanel');
  const loginPanel = document.getElementById('loginPanel');
  const forgotPanel = document.getElementById('forgotPanel');
  const authContainer = document.getElementById('authContainer');
  const appEl = document.getElementById('app');
  const balanceEl = document.getElementById('balanceNum');
  const todayCountEl = document.getElementById('todayCount');
  const taskLabelEl = document.getElementById('taskLabel');
  const watchAdBtn = document.getElementById('watchAdBtn');
  const creamStrip = document.getElementById('creamStrip');
  const welcomeMessageEl = document.getElementById('welcomeMessage');
  const withdrawBtn = document.getElementById('withdrawBtn');
  const withdrawModal = document.getElementById('withdrawModal');
  const closeWithdraw = document.getElementById('closeWithdraw');
  const submitWithdraw = document.getElementById('submitWithdraw');
  const withdrawMethodEl = document.getElementById('withdrawMethod');
  const withdrawNameEl = document.getElementById('withdrawName');
  const withdrawContactEl = document.getElementById('withdrawContact');
  const withdrawMsg = document.getElementById('withdrawMsg');
  
  // Profile Elements
  const profileAvatar = document.getElementById('profileAvatar');
  const profileName = document.getElementById('profileName');
  const profileEmail = document.getElementById('profileEmail');
  const profileMenuBtn = document.getElementById('profileMenuBtn');
  const profileDropdown = document.getElementById('profileDropdown');
  const viewProfileBtn = document.getElementById('viewProfileBtn');
  const settingsBtn = document.getElementById('settingsBtn');
  
  // Notification Elements
  const notificationIcon = document.getElementById('notificationIcon');
  const notificationBadge = document.getElementById('notificationBadge');
  const notificationPanel = document.getElementById('notificationPanel');
  const closeNotification = document.getElementById('closeNotification');
  const notificationList = document.getElementById('notificationList');
  const emptyNotification = document.getElementById('emptyNotification');
  const readAllBtn = document.getElementById('readAllBtn');
  
  // Elements for Auth and Errors
  const regMsg = document.getElementById('regMsg');
  const loginMsg = document.getElementById('loginMsg');
  const resetEmailEl = document.getElementById('resetEmail');
  const btnReset = document.getElementById('btnReset');
  const resetMsg = document.getElementById('resetMsg');
  const ipWarning = document.getElementById('ipWarning');
  const referralWarning = document.getElementById('referralWarning');
  
  // Elements for Progress Ring
  const leftFill = document.getElementById('leftFill');
  const rightFill = document.getElementById('rightFill');
  
  // Elements for Referral
  const userReferralCodeEl = document.getElementById('userReferralCode');
  const shareReferralBtn = document.getElementById('shareReferralBtn');
  const regReferralCodeEl = document.getElementById('regReferralCode');
  const tempReferralCodeEl = document.getElementById('tempReferralCode'); 
  const referralCountEl = document.getElementById('referralCount');
  
  // Ad Elements
  const adBannerTop = document.getElementById('adBannerTop'); 
  
  // Custom Variable for Progress Bar
  let targetTasks = 100; // আপডেট: সর্বনিম্ন এবং সর্বোচ্চ ১০০ টা কাজ
  
  const MIN_WITHDRAW_POINTS = 20; 
  const MAX_REFERRALS = 10; // Maximum number of referrals per user

  // --- IP ADDRESS TRACKING ---
  let userIP = null;
  
  // Function to get user IP address
  async function getUserIP() {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (error) {
      console.error('Error fetching IP address:', error);
      // Fallback to a different IP service if first one fails
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        return data.ip;
      } catch (fallbackError) {
        console.error('Fallback IP service also failed:', fallbackError);
        return null;
      }
    }
  }
  
  // Check if IP already exists in database
  async function checkIPExists(ip) {
    if (!ip) return false;
    
    try {
      const snapshot = await db.ref('users').orderByChild('ipAddress').equalTo(ip).once('value');
      return snapshot.exists();
    } catch (error) {
      console.error('Error checking IP:', error);
      return false;
    }
  }
  
  // Get IP address on page load
  document.addEventListener('DOMContentLoaded', async () => {
    userIP = await getUserIP();
    console.log('User IP:', userIP);
  });
  // ------------------------------

  // --- REFERRAL LIMIT CHECK ---
  // Check if referral code has reached its limit
  async function checkReferralLimit(referralCode) {
    if (!referralCode || referralCode.length !== 6) return { valid: false, message: "Invalid referral code" };
    
    try {
      // Find referrer by their code
      const snapshot = await db.ref('users')
          .orderByChild('referralCode')
          .equalTo(referralCode)
          .limitToFirst(1)
          .once('value');
      
      if (!snapshot.exists()) {
        return { valid: false, message: "Referral code does not exist" };
      }
      
      const referrerData = Object.values(snapshot.val())[0];
      const referralCount = referrerData.referralCount || 0;
      
      if (referralCount >= MAX_REFERRALS) {
        return { valid: false, message: `This referral code has reached its maximum limit of ${MAX_REFERRALS} referrals` };
      }
      
      return { valid: true, referrerUid: Object.keys(snapshot.val())[0] };
    } catch (error) {
      console.error('Error checking referral limit:', error);
      return { valid: false, message: "Error checking referral code" };
    }
  }
  // ------------------------------

  // --- UTILITY FUNCTIONS ---
  function getStartOfDay() {
    const now = new Date();
    now.setHours(0, 0, 0, 0);
    return now.getTime();
  }
  
  function timeAgo(timestamp) {
    const now = Date.now();
    const seconds = Math.floor((now - timestamp) / 1000);

    if (seconds < 60) return `${seconds} সেকেন্ড আগে`;
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `${minutes} মিনিট আগে`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `${hours} ঘণ্টা আগে`;
    const days = Math.floor(hours / 24);
    if (days < 60) return `${days} দিন আগে`;
    
    const date = new Date(timestamp);
    return date.toLocaleDateString('bn-BD', { year: 'numeric', month: 'short', day: 'numeric' });
  }

  // --- PROGRESS RING FUNCTION ---
  function updateProgressRing(currentCount, target) {
    const percentage = Math.min(currentCount / target, 1);
    const degree = percentage * 360;
    
    let rightRotation = Math.min(180, degree); 
    let leftRotation = Math.max(0, degree - 180); 

    rightFill.style.transform = `rotate(${rightRotation}deg)`;
    leftFill.style.transform = `rotate(${leftRotation - 180}deg)`; 
    
    if (currentCount >= target) {
        taskLabelEl.textContent = 'লক্ষ্য পূরণ ✅';
        watchAdBtn.disabled = true; 
        watchAdBtn.innerHTML = '<i class="fa-solid fa-circle-check"></i> আজকের কাজ শেষ। আগামীকাল আবার চেষ্টা করুন';
    } else {
        taskLabelEl.textContent = `আজকের কাজ (${target})`; 
        watchAdBtn.disabled = false; 
        watchAdBtn.innerHTML = '<i class="fa-solid fa-eye"></i> কাজ করে আয় করুন';
    }
    todayCountEl.textContent = currentCount; 
  }
  // ------------------------------
  
  // --- REFERRAL LOGIC ---
  function addReferralPoint(referralCode, newUserName) {
    if (!referralCode || referralCode.length !== 6) return;
    const newcomerName = newUserName || 'একজন নতুন ইউজার'; 

    // Find the referrer by their code
    db.ref('users')
        .orderByChild('referralCode')
        .equalTo(referralCode)
        .limitToFirst(1)
        .once('value', snapshot => {
            if (snapshot.exists()) {
                const referrerUid = Object.keys(snapshot.val())[0];
                const referrerRef = db.ref('users/' + referrerUid);
                
                // Add 1.0 point to referrer and increment referral count
                referrerRef.transaction(currentData => {
                    if (currentData) {
                        currentData.points = (currentData.points || 0.0) + 1.0; 
                        currentData.referralCount = (currentData.referralCount || 0) + 1;
                    }
                    return currentData;
                }).then(() => {
                    // Send notification with the new user's name
                    db.ref(`user_notifications/${referrerUid}`).push({
                        message: `অভিনন্দন! ${newcomerName} আপনার রেফারেল কোড ব্যবহার করে জয়েন করেছে। আপনার অ্যাকাউন্টে ১.০ পয়েন্ট যোগ করা হয়েছে।`,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        read: false
                    });
                });
            }
        });
  }

  // --- NOTIFICATION DISPLAY/HANDLING FUNCTIONS ---
  function renderNotifications(notifications) {
      notificationList.innerHTML = '';
      const allNotifications = Object.keys(notifications).map(key => ({ 
          id: key, 
          ...notifications[key] 
      })).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); 

      let unreadCount = 0;
      
      if (allNotifications.length === 0) {
          notificationList.appendChild(emptyNotification);
          readAllBtn.style.display = 'none';
          notificationBadge.style.display = 'none';
          return;
      } else {
          if (notificationList.contains(emptyNotification)) {
              notificationList.removeChild(emptyNotification);
          }
      }
      
      allNotifications.forEach(note => {
          if (!note.read) {
              unreadCount++;
          }
          
          const item = document.createElement('div');
          item.className = `notification-item ${note.read ? '' : 'unread'}`;
          item.dataset.id = note.id; 

          item.innerHTML = `
              <div class="notification-bell"><i class="fa-solid fa-bell"></i></div>
              <div class="notification-content">
                  <span class="notification-message">${note.message}</span>
                  <span class="notification-time">${timeAgo(note.timestamp || Date.now())}</span>
              </div>
          `;
          
          item.addEventListener('click', () => markNotificationAsRead(note.id));

          notificationList.appendChild(item);
      });
      
      if (unreadCount > 0) {
          notificationBadge.textContent = unreadCount;
          notificationBadge.style.display = 'flex';
          readAllBtn.style.display = 'inline-flex';
      } else {
          notificationBadge.style.display = 'none';
          readAllBtn.style.display = 'none';
      }
      
      if (allNotifications.length === 0) {
          notificationList.appendChild(emptyNotification);
      }
  }

  function markNotificationAsRead(id) {
      if (!auth.currentUser || !userNotificationsRef) return;
      userNotificationsRef.child(id).update({ read: true });
      const item = document.querySelector(`.notification-item[data-id="${id}"]`);
      if(item) {
          item.classList.remove('unread');
          item.style.fontWeight = '400'; 
      }
  }

  readAllBtn.addEventListener('click', () => {
      if (!auth.currentUser || !userNotificationsRef) return;
      const updates = {};
      
      userNotificationsRef.once('value', snapshot => {
          snapshot.forEach(child => {
              if (!child.val().read) {
                  updates[child.key + '/read'] = true;
              }
          });
          
          if (Object.keys(updates).length > 0) {
              userNotificationsRef.update(updates);
          }
          notificationPanel.classList.remove('open');
      });
  });
  
  // Notification Icon now just toggles the panel
  notificationIcon.addEventListener('click', (e) => {
      e.stopPropagation(); 
      notificationPanel.classList.toggle('open');
  });

  closeNotification.addEventListener('click', () => {
      notificationPanel.classList.remove('open');
  });
  
  document.addEventListener('click', (e) => {
    if (notificationPanel.classList.contains('open') && 
        !notificationPanel.contains(e.target) && 
        !notificationIcon.contains(e.target)) {
        notificationPanel.classList.remove('open');
    }
  });
  
  // --- DYNAMIC COLOR & SETTINGS FUNCTIONS ---
  function updateColorTheme(colors) {
      if (!colors) return;
      const root = document.documentElement;
      const colorMap = {
          primary: '--primary',
          secondary: '--secondary',
          accent: '--accent',
          success: '--success',
          text_light: '--text-light',
          card_bg: '--card-bg',
          shadow_color: '--shadow-color',
          workup_green: '--workup-green',
          workup_blue: '--workup-blue',
          dark_bg: '--dark-bg',
          bell_color: '--bell-color'
      };

      for (const key in colorMap) {
          if (colors[key] && typeof colors[key] === 'string' && colors[key].trim() !== '') {
              let colorValue = colors[key].trim();
              if (colorValue.length === 6 && !colorValue.startsWith('#')) {
                colorValue = '#' + colorValue; 
              }
              root.style.setProperty(colorMap[key], colorValue);
          }
      }
  }

  // আপডেট: Firebase থেকে সরাসরি ১০০ টাস্ক সেট করা
  db.ref('settings/daily_task_goal').set(100);
  
  db.ref('settings/color_theme').on('value', snap => {
    const colors = snap.val();
    if (colors && typeof colors === 'object') {
      updateColorTheme(colors);
    } 
  });

  db.ref('settings/daily_task_goal').on('value', snap => {
    const goal = snap.val();
    if (typeof goal === 'number' && goal > 0) {
      targetTasks = goal;
    } else {
      targetTasks = 100; // আপডেট: ডিফল্ট ১০০
    }
    if (auth.currentUser && currentUserRef) {
        currentUserRef.once('value').then(snap => {
             const data = snap.val() || {points:0, todayCount:0};
             updateProgressRing(data.todayCount || 0, targetTasks);
        });
    }
  });

  db.ref('settings/welcome_message').on('value', snap => {
    const message = snap.val();
    if (message && welcomeMessageEl) {
      welcomeMessageEl.textContent = message; 
    } else if (welcomeMessageEl) {
       welcomeMessageEl.textContent = 'কাজ করে টাকা আয় করুন — আমাদের ওয়েবসাইটে স্বাগতম!';
    }
  });
  
  // --- AUTH AND MAIN APP LOGIC ---
  
  // Auth Panel Toggles
  document.getElementById('showLogin').addEventListener('click', (e) => { 
      e.preventDefault(); 
      registerPanel.style.display='none'; 
      loginPanel.style.display='block'; 
      forgotPanel.style.display='none'; 
      loginMsg.textContent=''; 
  });
  
  document.getElementById('showRegister').addEventListener('click', (e) => { 
      e.preventDefault(); 
      registerPanel.style.display='block'; 
      loginPanel.style.display='none'; 
      forgotPanel.style.display='none'; 
      regMsg.textContent=''; 
  });

  document.getElementById('forgotPasswordLink').addEventListener('click', (e) => { 
      e.preventDefault(); 
      loginPanel.style.display='none'; 
      registerPanel.style.display='none';
      forgotPanel.style.display='block'; 
      resetMsg.textContent = ''; 
      resetEmailEl.value = '';
  });

  document.getElementById('showLoginFromForgot').addEventListener('click', (e) => { 
      e.preventDefault(); 
      forgotPanel.style.display='none'; 
      loginPanel.style.display='block'; 
      loginMsg.textContent=''; 
  });

  // 1. Registration
  document.getElementById('btnRegister').addEventListener('click', async ()=>{
      const name = document.getElementById('regName').value.trim(); 
      const email = document.getElementById('regEmail').value.trim();
      const pass = document.getElementById('regPass').value.trim();
      const termsChecked = document.getElementById('termsCheck').checked; 
      
      // নতুন: ইনপুট করা রেফার কোডটি নেওয়া হচ্ছে
      const invitedByCode = regReferralCodeEl.value.trim().toUpperCase(); 
      
      regMsg.textContent='';
      ipWarning.classList.remove('show');
      referralWarning.classList.remove('show');
      
      if(!name || !email || !pass){ regMsg.textContent='সমস্ত ফিল্ড পূরণ করুন'; return; }
      if(pass.length < 6){ regMsg.textContent='পাসওয়ার্ড কমপক্ষে 6 অক্ষর হওয়া উচিত'; return; }
      if(!termsChecked){ regMsg.textContent='অনুগ্রহ করে Terms of Service এ সম্মতি দিন'; return; } 
      
      // Get user IP if not already fetched
      if (!userIP) {
        userIP = await getUserIP();
      }
      
      // Check if IP already exists
      if (userIP) {
        const ipExists = await checkIPExists(userIP);
        if (ipExists) {
          ipWarning.classList.add('show');
          return;
        }
      }
      
      // Check if referral code is valid and within limit
      if (invitedByCode) {
        const referralCheck = await checkReferralLimit(invitedByCode);
        if (!referralCheck.valid) {
          referralWarning.classList.add('show');
          return;
        }
      }

      auth.createUserWithEmailAndPassword(email, pass).then((cred)=>{
        const uid = cred.user.uid;
        // নতুন: রেফার কোড তৈরি করা হচ্ছে (UID এর প্রথম 6 অক্ষর)
        const referralCode = uid.substring(0, 6).toUpperCase(); 

        db.ref('users/' + uid).set({ 
          points: 0.0, // Initial point set to 0.0
          todayCount: 0, 
          email: email, 
          name: name, 
          lastReset: getStartOfDay(),
          referralCode: referralCode, // নতুন
          invitedBy: invitedByCode || '', // নতুন: কোন কোড ব্যবহার করেছে
          ipAddress: userIP || 'unknown', // নতুন: IP ঠিকানা সংরক্ষণ
          referralCount: 0 // নতুন: রেফার কাউন্ট শুরু
        }).then(()=>{
           cred.user.updateProfile({ displayName: name });
           
           // পরিবর্তন: যদি কোনো রেফার কোড ব্যবহার করা হয়, তবে রেফারকারীকে পয়েন্ট এবং নতুন ইউজারের নাম পাঠানো হচ্ছে
           if (invitedByCode) {
               addReferralPoint(invitedByCode, name);
           }
        });
      }).catch(err=>{ 
        if(err.code === 'auth/email-already-in-use'){
            regMsg.textContent = 'এই ইমেলটি আগে থেকেই নিবন্ধিত। লগইন করুন।';
        } else if(err.code === 'auth/invalid-email'){
            regMsg.textContent = 'ইমেল ফরম্যাটটি সঠিক নয়।';
        } else if (err.message) {
            regMsg.textContent = 'অ্যাকাউন্ট তৈরি করার সময় একটি ত্রুটি হয়েছে: ' + err.message;
        } else {
            regMsg.textContent = 'অ্যাকাউন্ট তৈরি করার সময় একটি অজানা ত্রুটি হয়েছে।';
        }
      });
  });

  // 2. Login
  document.getElementById('btnLogin').addEventListener('click', ()=>{
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPass').value.trim();
      loginMsg.textContent='';
      if(!email || !pass){ loginMsg.textContent='ইমেইল এবং পাসওয়ার্ড দিন'; return; }
      
      auth.signInWithEmailAndPassword(email, pass).catch(err=>{ 
          if(err.code === 'auth/wrong-password') { 
              loginMsg.textContent = 'আপনার পাসওয়ার্ডটি ভুল হয়েছে';
          } 
          else if (err.code === 'auth/user-not-found') {
               loginMsg.textContent = 'আপনার ইমেলটি ভুল হয়েছে। এই ইমেল দিয়ে কোনো অ্যাকাউন্ট পাওয়া যায়নি।';
          }
          else if (err.code === 'auth/invalid-email' || err.code === 'auth/invalid-credential') {
              loginMsg.textContent = 'আপনার লগইন তথ্য সঠিক নয়। ইমেল বা পাসওয়ার্ড ভুল হয়েছে।';
          }
          else {
              loginMsg.textContent = 'লগইন করার সময় একটি অজানা ত্রুটি হয়েছে। পুনরায় চেষ্টা করুন।'; 
              console.error('Firebase Login Error:', err);
          }
      });
  });

  // 3. Password Reset
  btnReset.addEventListener('click', ()=>{
      const email = resetEmailEl.value.trim();
      resetMsg.textContent='';
      
      if(!email){ resetMsg.textContent='অনুগ্রহ করে ইমেল অ্যাড্রেস দিন'; return; }

      auth.sendPasswordResetEmail(email).then(()=>{
        resetMsg.style.color='green';
        resetMsg.textContent = '✅ পাসওয়ার্ড রিসেট লিংক আপনার ইমেলে পাঠানো হয়েছে। স্প্যাম ফোল্ডার চেক করুন।';
        
        setTimeout(() => {
            forgotPanel.style.display = 'none';
            loginPanel.style.display = 'block';
            resetMsg.style.color='#d32f2f'; 
        }, 3000); 
      }).catch(err=>{ 
        resetMsg.style.color='#d32f2f';
        if(err.code === 'auth/user-not-found'){
          resetMsg.textContent = 'এই ইমেল অ্যাড্রেসটি নিবন্ধিত নয়।';
        } else {
          resetMsg.textContent = err.message;
        }
      });
  });

  // Google Sign In/Register Functions
  document.getElementById('btnGoogleLogin').addEventListener('click', () => {
    auth.signInWithPopup(googleProvider)
      .then((result) => {
        // This gives you a Google Access Token. You can use it to access the Google API.
        const token = result.credential.accessToken;
        // The signed-in user info.
        const user = result.user;
        
        // Check if user exists in database
        db.ref('users/' + user.uid).once('value').then((snapshot) => {
          if (!snapshot.exists()) {
            // User doesn't exist, create a new record
            const referralCode = user.uid.substring(0, 6).toUpperCase();
            
            db.ref('users/' + user.uid).set({
              points: 0.0,
              todayCount: 0,
              email: user.email,
              name: user.displayName || 'Google User',
              lastReset: getStartOfDay(),
              referralCode: referralCode,
              invitedBy: '',
              ipAddress: userIP || 'unknown',
              referralCount: 0,
              isGoogleUser: true
            });
          }
        });
      })
      .catch((error) => {
        // Handle Errors here.
        const errorCode = error.code;
        const errorMessage = error.message;
        loginMsg.textContent = 'Google লগইন ব্যর্থ হয়েছে: ' + errorMessage;
        console.error('Google Sign In Error:', error);
      });
  });

  document.getElementById('btnGoogleRegister').addEventListener('click', async () => {
    const invitedByCode = regReferralCodeEl.value.trim().toUpperCase();
    const termsChecked = document.getElementById('termsCheck').checked;
    
    regMsg.textContent='';
    ipWarning.classList.remove('show');
    referralWarning.classList.remove('show');
    
    if(!termsChecked){ 
      regMsg.textContent='অনুগ্রহ করে Terms of Service এ সম্মতি দিন'; 
      return; 
    } 
    
    // Get user IP if not already fetched
    if (!userIP) {
      userIP = await getUserIP();
    }
    
    // Check if IP already exists
    if (userIP) {
      const ipExists = await checkIPExists(userIP);
      if (ipExists) {
        ipWarning.classList.add('show');
        return;
      }
    }
    
    // Check if referral code is valid and within limit
    if (invitedByCode) {
      const referralCheck = await checkReferralLimit(invitedByCode);
      if (!referralCheck.valid) {
        referralWarning.classList.add('show');
        return;
      }
    }
    
    auth.signInWithPopup(googleProvider)
      .then((result) => {
        // This gives you a Google Access Token. You can use it to access the Google API.
        const token = result.credential.accessToken;
        // The signed-in user info.
        const user = result.user;
        
        // Check if user already exists in database
        db.ref('users/' + user.uid).once('value').then((snapshot) => {
          if (!snapshot.exists()) {
            // User doesn't exist, create a new record
            const referralCode = user.uid.substring(0, 6).toUpperCase();
            
            db.ref('users/' + user.uid).set({
              points: 0.0,
              todayCount: 0,
              email: user.email,
              name: user.displayName || 'Google User',
              lastReset: getStartOfDay(),
              referralCode: referralCode,
              invitedBy: invitedByCode || '',
              ipAddress: userIP || 'unknown',
              referralCount: 0,
              isGoogleUser: true
            }).then(() => {
              // If user was referred, add referral point to referrer
              if (invitedByCode) {
                addReferralPoint(invitedByCode, user.displayName || 'Google User');
              }
            });
          } else {
            // User already exists, just log them in
            regMsg.textContent = 'এই Google অ্যাকাউন্ট দিয়ে ইতিমধ্যে নিবন্ধিত। লগইন করা হচ্ছে...';
          }
        });
      })
      .catch((error) => {
        // Handle Errors here.
        const errorCode = error.code;
        const errorMessage = error.message;
        regMsg.textContent = 'Google রেজিস্ট্রেশন ব্যর্থ হয়েছে: ' + errorMessage;
        console.error('Google Sign Up Error:', error);
      });
  });

  // COPY FUNCTION with FALLBACK
  function copyTextToClipboard(textToCopy) {
      // 1. Modern API attempt
      if (navigator.clipboard && window.isSecureContext) {
          return navigator.clipboard.writeText(textToCopy);
      } 
      
      // 2. Fallback: Old method using document.execCommand('copy')
      try {
          tempReferralCode.value = textToCopy;
          tempReferralCode.select();
          tempReferralCode.setSelectionRange(0, 99999); // For mobile devices
          const success = document.execCommand('copy');
          tempReferralCode.value = ''; // Clean up
          if (success) {
              return Promise.resolve();
          } else {
              return Promise.reject(new Error("ExecCommand failed to copy."));
          }
      } catch (err) {
          return Promise.reject(err);
      }
  }

  // Profile Dropdown Toggle
  profileMenuBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    profileDropdown.classList.toggle('active');
  });

  // Close profile dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!profileDropdown.contains(e.target) && !profileMenuBtn.contains(e.target)) {
      profileDropdown.classList.remove('active');
    }
  });

  // View Profile Button - Navigate to profile page
  viewProfileBtn.addEventListener('click', () => {
    profileDropdown.classList.remove('active');
    // Navigate to profile page
    window.location.href = 'profile.html';
  });

  // Settings Button
  settingsBtn.addEventListener('click', () => {
    profileDropdown.classList.remove('active');
    // Navigate to settings page
    window.location.href = 'settings.html';
  });

  // Auth state listener
  let currentUserRef = null;
  let userNotificationsRef = null; 
  auth.onAuthStateChanged(user => {
    if(user){
      authContainer.style.display='none';
      appEl.style.display='block';
      adBannerTop.style.display='flex'; // Show banner after login
      
      const uid = user.uid;
      currentUserRef = db.ref('users/' + uid);
      userNotificationsRef = db.ref(`user_notifications/${uid}`); 
      
      currentUserRef.once('value').then(snap=>{
        const data = snap.val() || {points:0.0, todayCount:0, lastReset: 0, referralCode: 'N/A'};
        const startOfDay = getStartOfDay();
        
        if(!snap.exists() || !data.lastReset) {
            // Initial setup or reset
            const newReferralCode = uid.substring(0, 6).toUpperCase();
            currentUserRef.set({ 
                points: 0.0, 
                todayCount: 0, 
                email: user.email, 
                name: user.displayName || '', 
                lastReset: startOfDay,
                referralCode: newReferralCode, 
                invitedBy: '',
                ipAddress: userIP || 'unknown', // নতুন: IP ঠিকানা সংরক্ষণ
                referralCount: 0, // নতুন: রেফার কাউন্ট শুরু
                isGoogleUser: data.isGoogleUser || false
            });
        } else if (data.lastReset < startOfDay) {
          currentUserRef.update({ todayCount: 0, lastReset: startOfDay });
        }
        
        // রেফার কোড ডিসপ্লে এবং শেয়ার বাটন সেটআপ
        const referralCode = data.referralCode || uid.substring(0, 6).toUpperCase(); 
        userReferralCodeEl.textContent = referralCode;
        
        // রেফার কাউন্ট ডিসপ্লে
        const referralCount = data.referralCount || 0;
        referralCountEl.textContent = referralCount;
        
        // --- রেফার কোড শেয়ার লজিক (শুধুমাত্র কপি হবে) ---
        shareReferralBtn.onclick = () => {
            const referralCodeToCopy = userReferralCodeEl.textContent.trim();
            const originalText = shareReferralBtn.innerHTML;
            const originalBg = shareReferralBtn.style.backgroundColor;

            // শুধুমাত্র রেফার কোডটি কপি করা হচ্ছে
            copyTextToClipboard(referralCodeToCopy).then(() => {
                // সফলভাবে কপি হলে বাটন টেক্সট পরিবর্তন ও ফিডব্যাক
                shareReferralBtn.innerHTML = '<i class="fa-solid fa-check"></i> রেফার কোড কপি হয়েছে!'; 
                shareReferralBtn.style.backgroundColor = 'var(--success)';
                
                setTimeout(() => {
                    shareReferralBtn.innerHTML = originalText;
                    shareReferralBtn.style.backgroundColor = originalBg; 
                }, 1500);
                
            }).catch(err => {
                console.error('Copy failed: ', err);
                alert(`আপনার রেফার কোড (${referralCodeToCopy}) কপি করতে ব্যর্থ হয়েছে। ম্যানুয়ালি কপি করার চেষ্টা করুন।`);
            });
        };
        // --- রেফার কোড শেয়ার লজিক শেষ ---
        
        // Update profile section
        const userName = data.name || 'User';
        profileName.textContent = userName;
        profileEmail.textContent = data.email || user.email;
        
        // Get first letter of name for avatar
        const firstLetter = userName.charAt(0).toUpperCase();
        profileAvatar.textContent = firstLetter;
      });
      
      // এককালীন ব্যালেন্স লোড করা হচ্ছে
      currentUserRef.once('value').then(snap => {
         const data = snap.val() || {points:0.0, todayCount:0};
         const todayCompleted = data.todayCount || 0;
         balanceEl.textContent = (data.points || 0.0).toFixed(1);
         updateProgressRing(todayCompleted, targetTasks);
      });
      
      userNotificationsRef.orderByChild('timestamp').limitToLast(20).on('value', snap => {
          const notifications = snap.val() || {};
          renderNotifications(notifications);
          
          const sixtyDaysAgo = Date.now() - (60 * 24 * 60 * 60 * 1000);
          const updates = {};
          snap.forEach(child => {
              if ((child.val().timestamp || 0) < sixtyDaysAgo) {
                  updates[child.key] = null;
              }
          });
          
          if (Object.keys(updates).length > 0) {
             userNotificationsRef.update(updates).catch(console.error);
          }
      });
      
      // নতুন লজিক এখানে কল হবে
      addPointOnTaskComplete(); 
      
    } else {
      authContainer.style.display='flex';
      appEl.style.display='none';
      adBannerTop.style.display='none'; // Hide banner after logout
      
      if(currentUserRef) currentUserRef.off();
      if(userNotificationsRef) userNotificationsRef.off(); 
      currentUserRef = null;
      userNotificationsRef = null;
      notificationPanel.classList.remove('open'); 
      // Ensure buttons are not disabled 
      document.querySelectorAll('.app .btn').forEach(btn => btn.disabled = false);
      document.getElementById('notificationIcon').style.pointerEvents = 'auto';
      // রেফার কোড ডিসপ্লে রিসেট
      if(userReferralCodeEl) userReferralCodeEl.textContent = 'Loading...'; 
    }
  });

  function showCream(){creamStrip.classList.add('show');setTimeout(()=>creamStrip.classList.remove('show'),2600)}
  
  // অ্যাড দেখার টাইমার এবং পয়েন্ট যোগ করার লজিক
  document.getElementById('watchAdBtn').addEventListener('click', ()=>{
      if(!auth.currentUser) return alert('প্রথমে লগইন করুন');
      
      // Check if tasks are completed
      if (parseInt(todayCountEl.textContent) >= targetTasks) {
          return; // already disabled
      }
      
      // Redirect to the Ad Viewing Page
      window.location.href = 'ad-view.html'; 
  });

  // URL চেক করে কাজ সম্পন্ন হলে পয়েন্ট যোগের লজিক
  function addPointOnTaskComplete() {
    const urlParams = new URLSearchParams(window.location.search);
    const taskCompleted = urlParams.get('task_completed');
    
    // যদি URL এ task_completed=true থাকে এবং ইউজার লগইন করা থাকে তবেই পয়েন্ট যোগ হবে
    if (taskCompleted === 'true' && auth.currentUser && currentUserRef) {
        // URL থেকে প্যারামিটারটি সরিয়ে দেওয়া
        window.history.replaceState({}, document.title, window.location.pathname);
        
        currentUserRef.transaction(currentData => {
            const data = currentData || { points: 0.0, todayCount: 0, lastReset: getStartOfDay() };
            
            const startOfDay = getStartOfDay();
            if (data.lastReset < startOfDay) {
                data.todayCount = 0;
                data.lastReset = startOfDay;
            }

            if ((data.todayCount || 0) < targetTasks) {
                data.points = (data.points || 0.0) + 0.1;
                data.todayCount = (data.todayCount || 0) + 1;
            } else {
                return; // টার্গেট পূরণ হয়ে গেলে পয়েন্ট যোগ হবে না
            }
            return data; 
        }).then(result => {
            if (result.committed) {
                showCream(); // সফল মেসেজ দেখাও
                // ব্যালেন্স রিয়েল-টাইম লিসেনার না থাকায় ম্যানুয়ালি আপডেট করা হলো
                if (result.snapshot.val()) {
                     balanceEl.textContent = (result.snapshot.val().points || 0.0).toFixed(1);
                     updateProgressRing(result.snapshot.val().todayCount || 0, targetTasks);
                }
            }
        }).catch(error => {
            console.error("Task Complete Transaction failed:", error);
        });
    }
  }

  // WITHDRAW LOGIC
  withdrawBtn.addEventListener('click', ()=>{
    if(!currentUserRef) return alert('প্রথমে লগইন করুন');
    
    // সরাসরি withdraw.html পেজে নিয়ে যাবে
    window.location.href = 'withdraw.html'; 
  });

  // Logout
  document.getElementById('btnLogout').addEventListener('click', ()=> {
    auth.signOut();
  });
  
  // DOMContentLoaded
  document.addEventListener('DOMContentLoaded', () => {
    // No ad loading functions here
  });
  </script>
  
  <script
    type="text/javascript"
    src="https://pl28222948.effectivegatecpm.com/39/f1/32/39f132e0ae73dc73515d7f87909e004f.js"
  ></script>

  <div class="ad-banner-container">
    <script type="text/javascript"> 
        atOptions = { 	
            'key' : 'a31f6440a4a178b774c075b06db0cbc5', 	
            'format' : 'iframe', 	
            'height' : 50, 	
            'width' : 320, 	
            'params' : {} 
        }; 
    </script> 
    <script type="text/javascript" src="https://www.highperformanceformat.com/a31f6440a4a178b774c075b06db0cbc5/invoke.js" ></script>
 </div>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js')
      .then(function(registration) {
        console.log('পাহারাদার (Service Worker) তৈরি হয়েছে!', registration.scope);
      }).catch(function(err) {
        console.log('তৈরি করতে সমস্যা হয়েছে:', err);
      });
  }
</script>
<script type="module">
    // ১. ফায়ারবেস মডিউলগুলো আনা হচ্ছে
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

    // ২. আপনার প্রজেক্টের তথ্য
    const firebaseConfig = {
        apiKey: "AIzaSyARwuMKNRPwqvaq2HnM-cW52ZVoTrDOLIQ",
        authDomain: "walletsystem-808df.firebaseapp.com",
        projectId: "walletsystem-808df",
        storageBucket: "walletsystem-808df.firebasestorage.app",
        messagingSenderId: "674874233210",
        appId: "1:674874233210:web:8588b19e748883182246c3",
        databaseURL: "https://walletsystem-808df-default-rtdb.firebaseio.com"
    };

    // ৩. ফায়ারবেস চালু করা
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);
    const db = getDatabase(app);

    // ৪. টোকেন তৈরি করে অটোমেটিক ডাটাবেজে সেভ করা
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then(function(registration) {
            const vapidKey = "BGucDKu-VlLpWI6PjWNLJ4xPvPPyggpxA0yd9ezKuBs5hC0V_U9BgAifNmEuwUciP_o3u7XgnJ6zMirz17zkKm4";

            getToken(messaging, { 
                vapidKey: vapidKey,
                serviceWorkerRegistration: registration 
            }).then((currentToken) => {
                if (currentToken) {
                    // এই লাইনটি আপনার টোকেনটি ডাটাবেজে পাঠিয়ে দিবে
                    set(ref(db, 'users_tokens/' + currentToken.substring(0, 10)), {
                        fcm_token: currentToken,
                        time: new Date().toLocaleString()
                    });
                    
                    alert("সফল! টোকেন ডাটাবেজে জমা হয়েছে।");
                }
            });
        });
    }
</script>
  </body>
</html>